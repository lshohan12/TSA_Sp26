---
title: "ENV 790.30 - Time Series Analysis for Energy Data | Spring 2025"
subtitle: "Assignment 3 - Due date 02/03/26"
author: "Lauren Shohan"
output: pdf_document
geometry: margin=2.54cm
editor_options: 
  chunk_output_type: console
---

```{r}

```

## Directions

You should open the .rmd file corresponding to this assignment on RStudio. The file is available on our class repository on Github.

Once you have the file open on your local machine the first thing you will do is rename the file such that it includes your first and last name (e.g., "LuanaLima_TSA_A03_Sp25.Rmd"). Then change "Student Name" on line 4 with your name.

Then you will start working through the assignment by **creating code and output** that answer each question. Be sure to use this assignment document. Your report should contain the answer to each question and any plots/tables you obtained (when applicable).

Please keep this R code chunk options for the report. It is easier for us to grade when we can see code and output together. And the tidy.opts will make sure that line breaks on your code chunks are automatically added for better visualization.

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,tidy.opts=list(width.cutoff=80), tidy=FALSE) 
```

When you have completed the assignment, **Knit** the text and code into a single PDF file. Submit this pdf using Sakai.

## Questions

Consider the same data you used for A2 from the spreadsheet "Table_10.1_Renewable_Energy_Production_and_Consumption_by_Source.xlsx". The data comes from the US Energy Information and Administration and corresponds to the December 2025 Monthly Energy Review. This time you will work only with the following columns: 
**Total Renewable Energy Production**; and 
**Hydroelectric Power Consumption**.

Create a data frame structure with these two time series only.

R packages needed for this assignment:"forecast","tseries", and "Kendall". Install these packages, if you haven't done yet. Do not forget to load them before running your script, since they are NOT default packages.\\

```{r}
#Load/install required package here
library(forecast)
library(tseries)
library(dplyr)
library(lubridate)
library(ggplot2)
library(readxl)
library(openxlsx)
library(Kendall)
library(cowplot)
```

```{r}
#extract data
energydata <- read_excel(path=
"/home/guest/TSA_Sp26/Data/Table_10.1_Renewable_Energy_Production_and_Consumption_by_Source.xlsx",
skip = 12, sheet="Monthly Data",col_names=FALSE)

#extract columns
energydata_cols <- read_excel(path=
"/home/guest/TSA_Sp26/Data/Table_10.1_Renewable_Energy_Production_and_Consumption_by_Source.xlsx",
skip = 10 ,n_max = 1, sheet="Monthly Data",col_names=FALSE) 

#assign column names to data
colnames(energydata) <- energydata_cols

#select columns i want - columns 4,5,6
energydata_2col <- energydata[,5:6]

head(energydata_2col)
```

```{r}
#converting into ts
#starting in 1973 and going monthly, thus freq is 12
ts_energydata <- ts(energydata_2col,start=c(1973,1), frequency=12) 
head(ts_energydata)

```


##Trend Component

### Q1

For each series (Total Renewable Production and Hydroelectric Consumption) create three plots arranged in a row (side-by-side): (1) time series plot, (2) ACF, (3) PACF. Use cowplot::plot_grid() to place them in a grid.


```{r}

cowplot::plot_grid(
  
autoplot(ts_energydata[,1], series = 'Total Renewable Energy Production') +
  xlab("Year") +
  ylab("Trillion BTU") +
  theme(legend.position = "none") +
  ggtitle('Total Renewable Energy Production Time Series'),

autoplot(Acf(ts_energydata[,1], lag.max = 40, plot = FALSE)) + ggtitle('ACF'),


autoplot(Pacf(ts_energydata[,1], lag.max = 40, plot = FALSE)) + ggtitle('PACF'), nrow=1
)

```

```{r}

plot_grid(
  
autoplot(ts_energydata[,2], series = 'Hydroelectric Power Consumption') +
  xlab("Year") +
  ylab("Trillion BTU") +
  theme(legend.position = "none") +
  ggtitle('Hydroelectric Power Consumption Time Series'),

autoplot(Acf(ts_energydata[,2], lag.max = 40, plot = FALSE)) + ggtitle('ACF'),


autoplot(Pacf(ts_energydata[,2], lag.max = 40, plot = FALSE)) + ggtitle('PACF'), nrow = 1
)


```

I also made them not three in a row because they squeezed when I did this (above) and it was hard to analyze them like this, I didn't want points off because they weren't directly in a row with one another though.
```{r}

cowplot::plot_grid(
  
autoplot(ts_energydata[,1], series = 'Total Renewable Energy Production') +
  xlab("Year") +
  ylab("Trillion BTU") +
  theme(legend.position = "none") +
  ggtitle('Total Renewable Energy Production Time Series'),

autoplot(Acf(ts_energydata[,1], lag.max = 40, plot = FALSE)) + ggtitle('ACF'),


autoplot(Pacf(ts_energydata[,1], lag.max = 40, plot = FALSE)) + ggtitle('PACF')
)

plot_grid(
  
autoplot(ts_energydata[,2], series = 'Hydroelectric Power Consumption') +
  xlab("Year") +
  ylab("Trillion BTU") +
  theme(legend.position = "none") +
  ggtitle('Hydroelectric Power Consumption Time Series'),

autoplot(Acf(ts_energydata[,2], lag.max = 40, plot = FALSE)) + ggtitle('ACF'),


autoplot(Pacf(ts_energydata[,2], lag.max = 40, plot = FALSE)) + ggtitle('PACF')
)

```


### Q2

From the plot in Q1, do the series Total Renewable Energy Production and Hydroelectric Power Consumption appear to have a trend? If yes, what kind of trend?

Total Renewable Energy Production appears to have an upward linear trend, with a small dip around year 2000. However, it steadily is rising over the years showcasing an increase of renewable enegy production coming onto the grid and the push for renewables. 
Hydroelectric power consumption shows a normal seasonal trend one can expect with hydro power, with a strong seasonal component showcases dips during drier periods and higher spikes for excess water periods. 

Both ACF graphs have a general downward trend over a certain amount of lags. This slow decay
likely indicates strong persistence or memory of the series. While the lags and spikes for the PACF graphs have decreased, the strong spikes at consistent intervals is a good indicator of seasonality.

------ CLASS NOTES ------
renewable
- acf slow decay means it has a long memory - PACF you can see some spikes 
- acf trend is so strong that it overlays the seasonality 
- pacf dont really worry about negative / positive spikes
- pacf is delayed at the seasonal marks bc its conditional on previous lags so it leaves some short term seasonal memory in the process

hydro 
- opposite of renewable - up and down and no general upward trend


### Q3

Use the *lm()* function to fit a linear trend to the two time series. Ask R to print the summary of the regression. Interpret the regression output, i.e., slope and intercept. Save the regression coefficients for further analysis.
```{r}
nobs <- nrow(ts_energydata)

#Create vector t
t <- c(1:nobs)

#fit linear trend to ts renewable and t
lm_renewable <- lm(ts_energydata[,1]~t)
summary(lm_renewable)

#fit linear trend to ts hydro and t
lm_hydro <- lm(ts_energydata[,2]~t)
summary(lm_hydro)
```

```{r}
#Store reg coefficient 
beta0_int_renewable <- as.numeric(lm_renewable$coefficients[1]) #intercept
beta1_slope_renewable <- as.numeric(lm_renewable$coefficients[2]) #slope

beta0_int_hydro <- as.numeric(lm_hydro$coefficients[1]) #intercept
beta1_slope_hydro <- as.numeric(lm_hydro$coefficients[2]) #slope
```

> Answer:
Renewable Energy Production summary:
    Intercept is at 171.448 while slope is 0.74999. These summary results show a very strong, positive statistically significant trend over time with a pvalue < 2.2e-16. The R^2 value of 0.8201 shows that around 82% of the variation can be accounted for by the renewable energy production, suggesting a pretty good model fit. 
Hydro Power Consumption summary:
    Intercept is at 83.2238 while slope is -0.012199. These summary results show a negative yet statistically significant trend over time with a pvalue 6.547e-05. The R^2 value of 0.02342 shows that only around 23% of the variation can be accounted for by hydro, which is very low suggesting other factors are in play when with the fluctuations of hydro consumption. 

---------- CLASS NOTES ----------
renewable - pvalue super low so meaninful regression - 82% of the time this is the result of the variability 
hydro - not great regression over time and is negative - time is only explaing 23% of the variability 


### Q4

Use the regression coefficients to detrend each series (subtract fitted linear trend). Plot detrended series and compare with the original time series from Q1. Describe what changed.
```{r}
# ----- renewable energy ----
#remove the trend from series
detrend_energy_data <- ts_energydata[,1] - (beta0_int_renewable + beta1_slope_renewable*t)
class(detrend_energy_data)

#transform to ts
ts_detrend_energy <- ts(detrend_energy_data,frequency = 12,start=c(1973,1))

#plot

autoplot(ts_energydata[,1], series = 'Original') +
  autolayer(ts_detrend_energy, series = 'Detrended') +
  xlab("Year") +
  ylab("Trillion BTU") +
  ggtitle('Original vs. Detrended Total Renewable Energy Production') +
  scale_color_manual(values = c('Original' = 'darkgreen', 'Detrended' = 'lightgreen'))
  


```


```{r}
# ----- hydro energy ----
#remove the trend from series
detrend_energy_data_hydro <- ts_energydata[,2] - (beta0_int_hydro + beta1_slope_hydro*t)
class(detrend_energy_data_hydro)

#transform to ts
ts_detrend_energy_hydro <- ts(detrend_energy_data_hydro,frequency = 12,start=c(1973,1))

#plot

autoplot(ts_energydata[,2], series = 'Original') +
  autolayer(ts_detrend_energy_hydro, series = 'Detrended') +
  xlab("Year") +
  ylab("Trillion BTU") +
  ggtitle('Original vs. Detrended Total Hydroelectric Power Consumption') +
  scale_color_manual(values = c('Original' = 'blue', 'Detrended' = 'lightblue'))
```

> Answer: Both renewable and hydro graphs show a difference after being detrended. Both detrended series are much lower than the original series, but follow similar patterns as the original. However, there is a difference. While hydro detrended seems to follow its original series dip for dip, the renewable energy detrended series is slightly different than the original. Around the year 1985-2000, while the original series increases, the detrended series decreases. Post 2000, both series follow an increasing trend. Both detrended series hover around the 0 trillion btu line, dipping into positive and negative values.

-------- CLASS NOTES ---------
renewable - detrended series is still trending over time - where the slope is higher in the OG is not enough to detrend it so its not stationary? perhaps linear trend model isnt the best to detrend the series - could detrend again??

hydro - detrended series is shifted down -- no change to the movement of the series over time 


### Q5

Plot ACF and PACF for the detrended series and compare with the plots from Q1. You may use plot_grid() again to get them side by side to make it easier to compare. Did the plots change? How?
```{r}
#renewable
plot_grid(
  autoplot(Acf(ts_detrend_energy, lag.max = 40, plot = FALSE)) + ggtitle('ACF Detrended Renewable'), #detrended
  autoplot(Pacf(ts_detrend_energy, lag.max = 40, plot = FALSE)) + ggtitle('PACF Detrended Renewable'),
  autoplot(Acf(ts_energydata[,1], lag.max = 40, plot = FALSE)) + ggtitle('ACF Original'), #original from q1
  autoplot(Pacf(ts_energydata[,1], lag.max = 40, plot = FALSE)) + ggtitle('PACF Original')
  )

```

```{r}
#hydro
plot_grid(
  autoplot(Acf(ts_detrend_energy_hydro, lag.max = 40, plot = FALSE)) + ggtitle('ACF Detrended Hydro'), #detrended
  autoplot(Pacf(ts_detrend_energy_hydro, lag.max = 40, plot = FALSE)) + ggtitle('PACF Detrended Hydro'),
  autoplot(Acf(ts_energydata[,2], lag.max = 40, plot = FALSE)) + ggtitle('ACF Original'), #original from q1
  autoplot(Pacf(ts_energydata[,2], lag.max = 40, plot = FALSE)) + ggtitle('PACF Original')
  )

```

> Answer: After detrending renewable, the ACF decayed much quicker than the original with it almost reaching 0.5 while the original ACF only made it to 0.75. The PACF graphs also became clearer after being detrended, with non signficant spikes increasing and becoming higher in the detrended PACF. However, with the hydro graphs nothing changed between the ACF and PACF detrended and original. 

------------CLASS NOTES -----------
RENEWABLE
- acf detrended - telling the same story of after detrending you still have slow decay of acf lags, but still not dropping to zero fast.. still slowly decaying over time and another indication that detrending wasnt successful 
    - detrended you can see the spikes more easily on 12,24,36 - eliminated confusion and emerged maybe there is a seasonal component
    - bc trend so strong its hard to make conclusions about seasonality 
- pacf - dont see alot of change except that coeeficients seem to be smaller 

HYDRO
- acf - very similar so that detrending didnt do much - still have seasonal component
- pacf similar behavior too 



## Seasonal Component

Set aside the detrended series and consider the original series again from Q1 to answer Q6 to Q8.

### Q6

Just by looking at the time series and the acf plots, do the series seem to have a seasonal trend? No need to run any code to answer your question. Just type in you answer below.

> Answer: Yes they both seem to have seasonality components. The hydro time series shows an obvious visual seasonality component from the time series graph, with dips and spikes correlately to certain months over and over again. The renewable time series potentially showcases seasonality in the PACF graphs with repeating spikes on certain intervals which indicates seasonality.  

### Q7

Use function *lm()* to fit a seasonal means model (i.e. using the seasonal dummies) to the two time series. Ask R to print the summary of the regression. Interpret the regression output. From the results, which series have a seasonal trend? Do the results match you answer to Q6?

```{r}
#----- renewable ---------
#First create the seasonal dummies
dummies_renewable <- seasonaldummy(ts_energydata[,1])

#Then fit a linear model to the seasonal dummies
seas_means_model_renewable <- lm(ts_energydata[,1]~dummies_renewable)
summary(seas_means_model_renewable)

```

```{r}
#----- hydroooooo ---------
#First create the seasonal dummies
dummies_hydro <- seasonaldummy(ts_energydata[,2])

#Then fit a linear model to the seasonal dummies
seas_means_model_hydro <- lm(ts_energydata[,2]~dummies_hydro)
summary(seas_means_model_hydro)

```

> Answer: None of the pvalues for renewable were statistically significant, going month by month none were significant nor was the main summary pvalue of 0.9223. Thus total renewable energy production doesnt show a statistically significant seasonal pattern, which was partially the conclusion i came to previously (i said there was an unclear seasonal pattern).
Going month by month with hydro shows that it has strong and statistically significant seasonality component with many months being signficant. This was the conclusion i came to previously. This is typical for hydro, with drier months lower production and more rainfall having higher production during summer/spring months. 


-----CLASS NOTES----
renewable - non statistically sig ... estimate is what you want for model but pvalue showing they arent different from zero?
  - what does this tell about seasonality - seasonality may not be present or seasonal means model isnt good rep for time series seasonal component 
  - even when you run it on detrended, and deseasoned its not a good rep and something is still covering the trend 
  
hydro - r squared value is strong?? 
  



### Q8

Use the regression coefficients from Q7 to deseason the series. Plot the deseason series and compare with the plots from part Q1. Did anything change?
```{r}
#Look at the regression coefficient. These will be the values of Beta
#Store regression coefficients

# ---- renewable ------
beta_int_renewable <- seas_means_model_renewable$coefficients[1]
beta_coeff_renewable <- seas_means_model_renewable$coefficients[2:12]

# ------- hydro ---------
beta_int_hydro <- seas_means_model_hydro$coefficients[1]
beta_coeff_hydro <- seas_means_model_hydro$coefficients[2:12]

```

------class notes------
trend still the same just reduced oscilations a bit
deseasoned brought level to zero bc of intercept term in regression model 


```{r}
#compute seasonal component
# ------- renewable -------
renewable_seas_comp <- array(0,nobs)
for(i in 1:nobs){
  renewable_seas_comp[i] <- (beta_int_renewable+beta_coeff_renewable %*% dummies_renewable[i,])
}

#Removing seasonal component
deseason_renewable_data <- ts_energydata[,1]-renewable_seas_comp

#Converting to a time series object
ts_deseason_renewable_data <- ts(deseason_renewable_data,frequency=12,start=c(1973,1))

#Understanding what we did
autoplot(ts_energydata[,1], series = 'Original') +
  autolayer(ts_deseason_renewable_data, series="Deseasoned") +
  ylab("Trillion BTU") +
  ggtitle('Original & Deseasoned Renewable Energy')

```

```{r}
#compute seasonal component
# ------- hydro -------
hydro_seas_comp <- array(0,nobs)
for(i in 1:nobs){
  hydro_seas_comp[i] <- (beta_int_hydro+beta_coeff_hydro %*% dummies_hydro[i,])
}

#Removing seasonal component
deseason_hydro_data <- ts_energydata[,2]-hydro_seas_comp

#Converting to a time series object
ts_deseason_hydro_data <- ts(deseason_hydro_data,frequency=12,start=c(1973,1))

#Understanding what we did
autoplot(ts_energydata[,2], series = 'Original') +
    autolayer(ts_deseason_hydro_data, series="Deseasoned")+
     ylab("Trillion BTU") + ggtitle('Original & Deseasoned Hydro Energy')

```
> Answer: Deseasoning had no effect on renewable production because the seasonal means model was not statistically significant thus it is the same graph just much lower. However, the deseasoned hydro graph does change and becomes smoother and easier to follow visually with reduced oscillations. Deseasoning hydro reduces these fluctuations which affirms my conclusion of a strong seasonality component. 


### Q9

Plot ACF and PACF for the deseason series and compare with the plots from Q1. You may use plot_grid() again to get them side by side. Did the plots change? How?

```{r}
#renewable
plot_grid(
  autoplot(Acf(ts_deseason_renewable_data, lag.max = 40, plot = FALSE)) + ggtitle('ACF Deseasoned Renewable'),
  autoplot(Pacf(ts_deseason_renewable_data, lag.max = 40, plot = FALSE)) + ggtitle('PACF Deseasoned Renewable'),
  autoplot(Acf(ts_energydata[,1], lag.max = 40, plot = FALSE)) + ggtitle('ACF Original'),
  autoplot(Pacf(ts_energydata[,1], lag.max = 40, plot = FALSE)) + ggtitle('PACF Original')
  )

#renewable
plot_grid(
  autoplot(Acf(ts_deseason_hydro_data, lag.max = 40, plot = FALSE)) + ggtitle('ACF Deseasoned Hydro'),
  autoplot(Pacf(ts_deseason_hydro_data, lag.max = 40, plot = FALSE)) + ggtitle('PACF Deseasoned Hydro'),
  autoplot(Acf(ts_energydata[,1], lag.max = 40, plot = FALSE)) + ggtitle('ACF Original'),
  autoplot(Pacf(ts_energydata[,1], lag.max = 40, plot = FALSE)) + ggtitle('PACF Original')
  )


```

> Answer: For renewable, the ACF graph did not change at all but the PACF deseasoned graph did change. The spikes decreased and basically all of them became insignificant. With hydro, both the ACF and PACF graph changed drastically. The ACF original showed a smooth downward trend, while the deseasoned one became bumpy, with a major wave in the middle and ultimately turned negative. The PACF deseasoned followed a similar trend to the renewable, with the PACF spikes decreased in height very signficantly compared to the original.   



want acf to drop to lower lags eventually 



